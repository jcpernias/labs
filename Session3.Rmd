---
title: "Tercera sesión de laboratorio"
author: "José C. Pernías"
date: "01/03/2015"
---

```{r, include=FALSE}
knitr::opts_chunk$set(fig.align='center', echo = FALSE)

library(MASS)

source("labdata.R")

library(ggplot2)
library(knitr)



## Cournot
## Mercado y matching definen las dos empresas de cada mercado
T2 <- rbind.fill(lab01$T2 %>% mutate(Lab = 1), 
                 lab02$T2 %>% mutate(Lab = 2), 
                 lab03$T2 %>% mutate(Lab = 3)) %>% 
  mutate(Period = as.factor(Period), 
         Subject = as.factor(100 * Lab + Subject), Lab = as.factor(Lab),  
         Price = precio, Quantity = cantidad, 
         OtherQuantity = otracantidad,
         MarketQuantity = cantidad + otracantidad,
         MarketID = factor(10 * mercado + matching)) %>%
  select(Period, Lab, Subject, MarketID, 
         Quantity, OtherQuantity, MarketQuantity, Price, Profit)



# St.lead <- filter(St, type == 1)
# St.foll <- filter(St, type == 2)
# 
# St.dQ <- select(St.lead, Period, cantidad, otracantidad) %>%
#   mutate(dQ = cantidad - otracantidad, dQpos = dQ > 0, 
#          dQeq = dQ == 0, dQneg = dQ < 0)

## Dispersion plot showing response of followers to the leaders stratetegies.
## Points of different periods in different colors

# ddply(st.dQ, .(Period), summTable, "dQ")
# ddply(st.dQ, .(Period), function (df) colSums (select(df, dQpos, dQeq, dQneg)))
# 
# 
# 
# ddply (Co, .(Period), summTable, "cantidad")



lab01 <- readSubjectsTables("LA01.xls")
lab02 <- readSubjectsTables("LA02.xls")
lab03 <- readSubjectsTables("LA03.xls")
lab16 <- readSubjectsTables("LA16.xls")
lab17 <- readSubjectsTables("LA17.xls")

St <- rbind.fill (lab01$T1, lab02$T1, lab03$T1, lab16$T1, lab17$T1) 
Co <- rbind.fill (lab01$T2, lab02$T2, lab03$T2, lab16$T2, lab17$T2) 

St <- mutate(St, Period = as.factor(Period))
Co <- mutate(Co, Period = as.factor(Period))

St.lead <- filter(St, type == 1)
St.foll <- filter(St, type == 2)

St.dQ <- select(St.lead, Period, cantidad, otracantidad) %>%
  mutate(dQ = cantidad - otracantidad, dQpos = dQ > 0, 
         dQeq = dQ == 0, dQneg = dQ < 0)

Co.low <-  filter(Co, type == 1)
Co.high <- filter(Co, type == 2)
Co.dQ <- select(Co.low, Period, cantidad, otracantidad) %>%
  mutate(dQ = cantidad - otracantidad, dQpos = dQ > 0, 
         dQeq = dQ == 0, dQneg = dQ < 0)




```

## Tratamiento 1

* Dos empresas sirven el mercado de un producto homogéneo.
* Cada unidad producida tiene un coste unitario de $200$ €.
* Cada periodo las empresas deciden simultáneamente cuántas unidades va a producir.
* La demanda determina el precio al que se venden todas las unidades.

## La elección del nivel de producción

- Funciones de reacción:
  \[
    \begin{gather*}
      q_1^* = 300 - \frac{q_2}{2} \\
      q_2^* = 300 - \frac{q_1}{2}
    \end{gather*}
  \]
- La primera ecuación expresa la producción que maximiza los beneficios de la empresa 1 _si la empresa 2 produce $q_2$_.
- La segunda ecuación expresa la producción que maximiza los beneficios de la empresa 2 _si la empresa 1 produce $q_1$_.

## Equilibrio de Nash

- En equilibrio la producción de cada una de las empresas es la mejor respuesta a las decisiones de producción de sus rivales.
  \[
    \begin{gather*}
      q_1^* = 300 - \frac{q^*_2}{2} \\
      q_2^* = 300 - \frac{q^*_1}{2}
    \end{gather*}
  \]
- En equilibrio $q^*_1 = q^*_2 = 200$ unidades.
- El precio de equilibrio es $P^* = 500 - 400/2 = 300$ €/u.
- Los beneficios son $\pi^*_1 = \pi^*_2 = 20000$ €.  
  
  
## Estadísticos descriptivos

### Producción de las empresas
```{r}

kable(ddply (T2, .(Period), summTable, "Quantity"),
  digits = 1)      

```




## Distribución de las cantidades

### Producción de las empresas
```{r}

ggplot(T2, aes(Period, Quantity)) + 
  geom_boxplot(fill="orange", alpha = 0.3) +
  geom_hline(yintercept = 200, color = "DarkGreen", size = 1, alpha = 0.5) +
  ylab("q")
```





## Tratamiento 2

* Dos empresas sirven el mercado de un producto homogéneo.
* El coste unitario de la empresa 1 es de \(200\ €\) mientras que el de la empresa 2 es de \(290\ €\).
* Cada periodo las empresas deciden simultáneamente cuántas unidades va a producir.
* La demanda determina el precio al que se venden todas las unidades.

## La elección del nivel de producción

- Funciones de reacción:
  \[
    \begin{gather*}
      q_1^* = 300 - \frac{q_2}{2} \\
      q_2^* = 210 - \frac{q_1}{2}
    \end{gather*}
  \]
- La primera ecuación expresa la producción que maximiza los beneficios de la empresa 1 _si la empresa 2 produce $q_2$_.
- La segunda ecuación expresa la producción que maximiza los beneficios de la empresa 2 _si la empresa 1 produce $q_1$_.

## Equilibrio de Nash

- En equilibrio la producción de cada una de las empresas es la mejor respuesta a las decisiones de producción de sus rivales.
  \[
    \begin{gather*}
      q_1^* = 300 - \frac{q^*_2}{2} \\
      q_2^* = 210 - \frac{q^*_1}{2}
    \end{gather*}
  \]
- En equilibrio $q^*_1 = 260$ y  $q^*_2 = 80$ unidades.
- El precio de equilibrio es $P^* = 500 - 340/2 = 330$ €/u.
- Los beneficios son $\pi^*_1 = 33800$ y $\pi^*_2 = 3200$ €.  
  



## Estadísticos descriptivos
### Producción de la empresa con costes bajos


```{r}

kable(ddply (Co.low, .(Period), summTable, "cantidad"),
  digits = 1)      

```


## Estadísticos descriptivos
### Producción de la empresa con costes altos


```{r}

kable(ddply (Co.high, .(Period), summTable, "cantidad"),
  digits = 1)      

```



## Distribución de la producción
### Empresa con costes bajos

```{r}

ggplot(Co.low, aes(Period, cantidad)) + 
  geom_boxplot(fill="orange", alpha = 0.3) +
  geom_hline(yintercept = 260, color = "DarkGreen", size = 1, alpha = 0.5) +
  ylab("q1") 

```

## Distribución de la producción
### Empresa con costes altos

```{r}

ggplot(Co.high, aes(Period, cantidad)) + 
  geom_boxplot(fill="orange", alpha = 0.3) +
  geom_hline(yintercept = 80, color = "DarkGreen", size = 1, alpha = 0.5) +
  ylab("q2") 

```

## Comparación de las cantidades
### Diferencia de las producciones de las dos empresas

```{r}

ggplot(Co.dQ, aes(Period, dQ)) + 
  geom_boxplot(fill="orange", alpha = 0.3) +
  geom_hline(yintercept = 180, color = "DarkGreen", size = 1, alpha = 0.5) +
  ylab("q1 - q2") 

```

